# Doctor Appointment Booking System

## Doctor Availability Module

This module is part of a **Doctor Appointment Booking System** and is responsible for managing the availability slots of a doctor. It allows the doctor to list their available slots and add new slots. The module is built using **Spring Boot** and **MongoDB** and follows a **Traditional Layered Architecture**.

---

### **Features**

1. **List Slots**:
   - Retrieve all slots for the doctor.
2. **Add New Slots**:
   - Add new availability slots with details such as time, doctor ID, doctor name, cost, and reservation status.
3. **Automatic Timestamp**:
   - Automatically track when a slot was created using the `createdAt` field.

---

### **Entity Details**

#### **Slot Entity**

The `Slot` entity represents an availability slot for the doctor. It has the following fields:

| Field Name   | Data Type | Description                                       |
| ------------ | --------- | ------------------------------------------------- |
| `id`         | `String`  | Auto-generated by MongoDB (ObjectId).             |
| `createdAt`  | `Date`    | Automatically populated when the slot is created. |
| `time`       | `Date`    | The date and time of the slot.                    |
| `doctorId`   | `UUID`    | The unique ID of the doctor.                      |
| `doctorName` | `String`  | The name of the doctor.                           |
| `isReserved` | `boolean` | Indicates whether the slot is reserved.           |
| `cost`       | `double`  | The cost of the appointment.                      |

---

### **API Endpoints**

#### **1. List All Slots**

- **Endpoint**: `GET /api/doctor-slots`
- **Description**: Retrieves all slots.
- **Response**:
  ```json
  [
    {
      "doctorName": "Dr. Hussein",
      "cost": 100,
      "time": "2025-01-11T00:02:06.468+00:00",
      "doctorId": "6781b4fe33bc031f85f65817",
      "reserved": true
    },
    {
      "doctorName": "Dr. Hussein",
      "cost": 150,
      "time": "2025-01-11T00:02:06.679+00:00",
      "doctorId": "6781b4fe33bc031f85f65818",
      "reserved": false
    },
    {
      "doctorName": "Dr. Hussein",
      "cost": 200,
      "time": "2025-01-11T00:02:06.795+00:00",
      "doctorId": "6781b4fe33bc031f85f65819",
      "reserved": false
    }
  ]
  ```

#### **2. Add a New Slot**

- **Endpoint**: `POST /api/doctor-slots`
- **Description**: Adds a new availability slot.
- **Request Body**:
  ```json
  [
    {
      "doctorName": "Dr. Hussein",
      "isReserved": false,
      "cost": 100.0
    },
    {
      "doctorName": "Dr. Hussein",
      "isReserved": false,
      "cost": 150.0
    },
    {
      "doctorName": "Dr. Hussein",
      "isReserved": false,
      "cost": 200.0
    }
  ]
  ```
- **Response**:
  ```json
  Slots added successfully
  ```

---

### **Automatic Timestamp**

The `createdAt` field is automatically populated when a new slot is created. This is achieved using Spring Data MongoDB's `@CreatedDate` annotation and enabling auditing with `@EnableMongoAuditing`.

### **Database Configuration**

The application uses **MongoDB** as the database. The connection details are configured in the `application.properties` file.

## Appointment Booking Module

This module is part of a **Doctor Appointment Booking System** and is responsible for allowing patients to view available slots and book appointments. It follows the **Clean Architecture** principles, ensuring separation of concerns, testability, and independence from frameworks and databases. The module is built using **Spring Boot** and **MongoDB**.

---

### **Features**

1. **View Available Slots**:
   - Patients can view all available slots (where `isReserved` is `false`).
2. **Book an Appointment**:
   - Patients can book an appointment on an available slot.
3. **Appointment Confirmation**:
   - Once an appointment is booked, the slot is marked as reserved, and the appointment details are saved in the database.
4. **Automatic Timestamp**:
   - The `reservedAt` field is automatically populated when an appointment is booked.

---

### **Entity Details**

#### **Appointment Entity**

The `Appointment` entity represents a booked appointment. It has the following fields:

| Field Name    | Data Type | Description                                             |
| ------------- | --------- | ------------------------------------------------------- |
| `id`          | `String`  | Auto-generated by MongoDB (ObjectId).                   |
| `slotId`      | `UUID`    | The ID of the booked slot.                              |
| `patientId`   | `UUID`    | The unique ID of the patient.                           |
| `patientName` | `String`  | The name of the patient.                                |
| `reservedAt`  | `Date`    | Automatically populated when the appointment is booked. |

---

### **API Endpoints**

### **1. View Available Slots**

- **Endpoint**: `GET /api/appointments/available-slots`
- **Description**: Retrieves all available slots (where `isReserved` is `false`).
- **Response**:
  ```json
  [
    {
      "doctorName": "Dr. Hussein",
      "cost": 150,
      "time": "2025-01-11T00:02:06.679+00:00",
      "doctorId": "6781b4fe33bc031f85f65818",
      "reserved": false
    },
    {
      "doctorName": "Dr. Hussein",
      "cost": 200,
      "time": "2025-01-11T00:02:06.795+00:00",
      "doctorId": "6781b4fe33bc031f85f65819",
      "reserved": false
    }
  ]
  ```

### **2. Book an Appointment**

- **Endpoint**: `POST /api/appointments/book`
- **Description**: Books an appointment on an available slot.
- **Request Body**:
  ```json
  {
    "slotId": "6781b4fe33bc031f85f65817",
    "patientId": "987e6543-e21b-12d3-a456-426614174000",
    "patientName": "Ayman"
  }
  ```
- **Response**:
  ```json
  {
    "reservedAt": "2025-01-11T11:25:19.527+00:00",
    "slotId": "6781b4fe33bc031f85f65818",
    "patientName": "Ayman",
    "patientId": "6782551fe4a2374359b844fb"
  }
  ```

---

### **Automatic Timestamp**

The `reservedAt` field is automatically populated when an appointment is booked. This is achieved using Spring Data MongoDB's `@CreatedDate` annotation and enabling auditing with `@EnableMongoAuditing`.

---

## Appointment Confirmation Module

This module is part of a **Doctor Appointment Booking System** and is responsible for sending confirmation notifications to patients and doctors once an appointment is booked. It follows a **three-tier architecture** to ensure separation of concerns, modularity, and scalability. The module is built using **Spring Boot** and leverages **Spring Events** for decoupled event handling.

---

### **Features**

1. **Confirmation Notification**:
   - Sends a confirmation notification (as a log message) to the patient and doctor after an appointment is booked.
2. **Event-Driven Architecture**:
   - Uses **Spring Events** to decouple the appointment booking logic from the confirmation logic.
3. **Three-Tier Architecture**:
   - Separates the application into **Presentation**, **Business Logic**, and **Data Access** layers for better maintainability.

### **Three-Tier Architecture**

#### **1. Presentation Layer**

- **Controller**: `AppointmentConfirmationController`
  - Exposes REST endpoints for triggering confirmation notifications.
- **API Endpoint**:
  - `POST /api/appointments/confirm`: Triggers a confirmation notification.

#### **2. Business Logic Layer**

- **Service**: `AppointmentConfirmationService`
  - Handles the logic for generating and logging confirmation messages.
- **Event Listener**: `AppointmentBookedEventListener`
  - Listens for `AppointmentBookedEvent` and triggers the confirmation process.

#### **3. Data Access Layer**

- **Repository**: `SlotRepository`
  - Fetches slot details (e.g., doctor's name) from the database.

---

### **How It Works**

1. When an appointment is booked, the `AppointmentBookedEvent` is published.
2. The `AppointmentBookedEventListener` listens for the event and fetches the doctor's name using the `slotId`.
3. The `AppointmentConfirmationService` generates and logs the confirmation message.

---

### **Event Handling**

The module uses **Spring Events** to decouple the appointment booking logic from the confirmation logic.

#### **Event Flow**

1. **Event Publishing**:
   - The `AppointmentServiceImpl` publishes an `AppointmentBookedEvent` when an appointment is booked.
2. **Event Listening**:
   - The `AppointmentBookedEventListener` listens for the event and calls the `AppointmentConfirmationService` to log the confirmation message.

### **Technologies Used**

- **Backend**: Spring Boot (Java)
- **Database**: MongoDB
- **Architecture**: Traditional Layered Architecture
- **Build Tool**: Maven
- **Testing Framework**: JUnit, Mockito (for unit and integration tests)

---

### **How to Run**

#### **Prerequisites**

- Java 23
- Maven installed

#### **Steps**

1. Clone the repository:
   ```bash
   git clone https://github.com/Hussein119/Modular-Monolith-Assessment.git
   ```
2. Navigate to the project directory:
   ```bash
   cd doctorappointment
   ```
3. Build the project:
   ```bash
   ./mvnw clean install
   ```
4. Run the application:
   ```bash
   ./mvnw spring-boot:run
   ```
5. Access the API at `http://localhost:8080`.

---

### **Testing**

The module includes unit and integration tests to ensure functionality.

#### **Run Tests**

```bash
./mvnw test
```

---

### **Future Improvements**

- Add authentication and authorization.
- Add pagination and filtering for listing slots.
- Replace the log message with real notifications (e.g., email, SMS).
- Add more details to the confirmation message (e.g., appointment ID, cost).
- Implement error handling for failed notifications.

---

### **License**

This project is licensed under the MIT License.
